# Web Code Viewer/Editor

　HTMLでソースコードを表示・編集するUIが欲しい。

## 問題

　既存UIでは問題がある。

既存UI|問題
------|----
`<textarea>`|`TAB`キーでインデントできずフォーカスしてしまう。構文ハイライト不可
[Ace][]([Demo][Ace Demo])等|`TAB`キーでインデントされフォーカスできない

既存UI|問題
------|----
`<pre><code>` + [hljs][]|入力不可
`<pre><code contenteditable>` + [hljs][]|`Enter`キー押下するとカーソルが最初に戻ってしまう
[Editor.js][] + [CodeFlask][]|マウス操作必須（block style editor）。`TAB`キー押下するとフォーカスとインデントが同時実行されてしまう

[Ace]:https://github.com/ajaxorg/ace?tab=readme-ov-file#documentation
[Ace Demo]:https://ace.c9.io/build/kitchen-sink.html
[hljs]:https://highlightjs.org/
[Editor.js]:https://editorjs.io/
[CodeFlask]:https://github.com/calumk/editorjs-codeflask

　それとCodePenの埋込エディタのように複数画面を持たせたい場合にも対応したい。

## 理想

* フォーカス・インデント共に`TAB`キーでできる
* 一度に行われるのはどちらか一方だけ
* View/Editでモード切替することで実現したい

モード|`TAB`|`Shift`+`TAB`|モード変更
------|-----|-------------|----------
`View`|次のHTML要素へフォーカス|前のHTML要素へフォーカス|`TAB`,`Shift`キー以外の全キー
`Edit`|インデント|アンインデント|`ESC`キー(複数Editor包含時は`Ctrl`+`TAB`キーで遷移(`Shift`を加えると前の要素へ))

　次のような課題がある。しかしこれは無駄に説明的になってしまい画面領域を圧迫する。`？`アイコンに要約するなどの工夫が必要か。

* モード切替
    * キーバインドだけでなくマウスやタップでも切替可能にするUIを実装すべき
* モード表示
    * 現在のモード表示と、その意味と、切り替えるための操作方法を提示すべき

　Viewモード時は次のような状態がある。`View`,`Copy`,`Edit`の3モードにすると切替が面倒になる。どうするか。

* `View`モード時
    * 編集もコピーも不要ならUIは`disabled`でいいはず（フォーカス不可能）
    * 編集はしないがクリップボードコピーしたい場合はどうするか
        * UIは`readonly`であるべき（フォーカス、コピー可能）

　次のような機能が欲しい。

* 出力
    * クリップボード（コピー）
    * ファイル
        * HTML(CSS,JSを内包した)
        * ZIP(HTML,CSS,JSを別ファイル化した)
            * no-module(`<script src="main.js">`)
            * es-module(`<script type="module" src="main.js">`)
    * IndexedDB
    * BlueTooth
    * WebAPI
        * GitHub push
        * Google Drive
        * Dropbox
* 入力
    * クリップボード（ペースト）
    * ファイル（DnD）
        * HTML
        * ZIP
        * Directory
    * IndexedDB
    * BlueTooth
    * WebAPI

　その場でHTTPSサーバを起動してデプロイしたいのだが、そんなことができる機能はJS-APIに存在しない。セキュリティ関係だと思われる。

## 現実

　あまりにも果てしない挑戦になる。

　まずは`<textarea>`に`TAB`キーでインデント機能を追加したい。

　このときフォーカスをどうするか問題がある。

機能|キーバインド
----|------------
フォーカス(次)|`TAB`
フォーカス(前)|`Shift`+`TAB`
インデント|`Ctrl`+`TAB`
アンインデント|`Ctrl`+`Shift`+`TAB`

　尚、`Alt`+`TAB`は次の機能が割り当てられているので使えない。

機能|キーバインド
----|------------
ウインドウ切替(次)|`Alt`+`TAB`
ウインドウ切替(前)|`Alt`+`Shift`+`TAB`

　また、`Ctrl`+`TAB`もブラウザで予約されている。

機能|キーバインド
----|------------
ブラウザのタブ切替(次)|`Ctrl`+`TAB`
ブラウザのタブ切替(前)|`Ctrl`+`Shift`+`TAB`

機能|キーバインド
----|------------
テキストエリアの範囲選択(次列)|`Shift`+`→`
テキストエリアの範囲選択(前列)|`Shift`+`←`
テキストエリアの範囲選択(次行)|`Shift`+`↓`
テキストエリアの範囲選択(前行)|`Shift`+`↑`

機能|キーバインド
----|------------
テキストエリアの単語間カーソル遷移(次)|`Ctrl`+`→`
テキストエリアの単語間カーソル遷移(前)|`Ctrl`+`←`

　なのでモード切替によってインデントとフォーカスを切り替えるしかない。

## モード切替

名称|状態
----|----
`enabled`|テキスト編集できる
`readonly`|テキスト編集できない（テキスト選択やコピーは可能）
`disabled`|グレーアウトしてフォーカスが当たらない

## インデント

* テキストを範囲選択していない
    * カーソルがある位置でインデント／アンインデントする
* テキストを範囲選択している
    * テキストを範囲選択した全行に対してインデント／アンインデントする

　さらに細かく考えると次のようになる。

* 範囲選択なし: カーソル位置の後にTAB字を挿入／カーソル位置の前にあるTAB字を削除
* 範囲選択あり: 全行インデント／アンインデント
    * 次のように場合分けすることも考えたが、置換するよりカーソル途中位置でインデント／アンインデントするほうが要件に見合う
        * 改行を跨ぐ    :全行インデント／アンインデント
        * 改行を跨がない:１行選択範囲をインデント文字に置換する

　テキストの途中にインデント文字を挿入したいなら範囲選択せずカーソル位置を挿入したい位置にあわせて入力する。

　行頭・行末のインデント・アンインデントをしたいなら、それをしたい行を範囲選択してキー入力する。
　インデントならカーソル位置に挿入する。
　アンインデントならカーソル位置の前を削除する。




